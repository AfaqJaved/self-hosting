version: '3.8'

services:
  quay:
    image: quay.io/projectquay/quay
    container_name: quay
    restart: always
    environment:
      - DATABASE_URI=${DATABASE_URI}
      - REDIS_HOST=${REDIS_HOST}
      - QUAY_SUPER_USERS=${QUAY_SUPER_USERS}
      - SERVER_HOSTNAME=${SERVER_HOSTNAME}
    volumes:
      - app_storage:/datastorage
      - /opt/quay/quay_config:/conf/stack  # Mount local config directory with config.yaml
      - app_log:/var/log
      - app_tmp:/tmp
    networks:
      - nginx
      - shared_postgres
      - shared_redis
    # Using NPM as reverse proxy, so ports are not exposed here
    # ports:
    #   - 80:80

volumes:
  app_storage:
    driver: local
  app_log:
    driver: local
  app_tmp:
    driver: local

networks:
  nginx:
    external: true
  shared_postgres:
    external: true
  shared_redis:
    external: true
